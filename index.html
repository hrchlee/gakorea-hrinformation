<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GA KOREA ì¸ì‚¬ì •ë³´ë“±ë¡ (Firebase)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Malgun Gothic', sans-serif; background: #f5f6f8; font-size: 12px; }
        .login-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .login-box { background: white; padding: 50px; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); width: 450px; }
        .login-header { text-align: center; margin-bottom: 40px; }
        .login-header h1 { color: #333; font-size: 28px; margin-bottom: 10px; }
        .login-header p { color: #666; font-size: 14px; }
        .firebase-badge { background: #ff9800; color: white; padding: 4px 12px; border-radius: 12px; font-size: 11px; display: inline-block; margin-top: 10px; }
        .login-form .form-group { margin-bottom: 20px; }
        .login-form label { display: block; margin-bottom: 8px; color: #333; font-weight: bold; }
        .login-form input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .login-btn { width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .error-msg { background: #ffebee; color: #c62828; padding: 12px; border-radius: 4px; margin-bottom: 20px; display: none; text-align: center; }
        .main-screen { display: none; }
        .main-screen.active { display: block; }
        .header { background: white; border-bottom: 2px solid #e0e0e0; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .header-left h1 { color: #333; font-size: 18px; font-weight: bold; }
        .header-right { display: flex; gap: 15px; align-items: center; }
        .logout-btn { padding: 8px 16px; background: white; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .tab-menu { background: white; border-bottom: 1px solid #e0e0e0; padding: 0 30px; display: flex; gap: 5px; }
        .tab-btn { padding: 12px 20px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-size: 13px; color: #666; }
        .tab-btn.active { color: #1976d2; border-bottom-color: #1976d2; font-weight: bold; }
        .layout { display: flex; height: calc(100vh - 120px); }
        .sidebar { width: 250px; background: white; border-right: 1px solid #e0e0e0; padding: 20px; overflow-y: auto; }
        .main-content { flex: 1; background: white; overflow-y: auto; padding: 25px; }
        .filter-section { margin-bottom: 25px; }
        .filter-section h3 { font-size: 13px; margin-bottom: 12px; font-weight: bold; }
        .filter-group { margin-bottom: 12px; }
        .filter-group label { display: block; margin-bottom: 6px; font-size: 12px; color: #666; }
        .filter-group input, .filter-group select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 3px; font-size: 12px; }
        .radio-group { display: flex; gap: 15px; margin-top: 8px; }
        .employee-list { border-top: 1px solid #e0e0e0; margin-top: 15px; padding-top: 15px; }
        .employee-item { padding: 10px; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; }
        .employee-item:hover { background: #f5f9ff; border-color: #1976d2; }
        .employee-item .name { font-weight: bold; color: #333; margin-bottom: 4px; }
        .employee-item .info { font-size: 11px; color: #666; }
        .btn { padding: 10px 25px; border: none; border-radius: 4px; font-size: 13px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #1976d2; color: white; }
        .btn-secondary { background: #757575; color: white; }
        .btn-outline { background: white; border: 1px solid #ddd; color: #666; }
        .form-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        .form-table tr { border-bottom: 1px solid #f0f0f0; }
        .form-table th { width: 150px; padding: 12px; text-align: left; background: #fafafa; color: #333; font-weight: 600; font-size: 12px; border-right: 1px solid #e0e0e0; vertical-align: top; }
        .form-table td { padding: 12px; }
        .form-table input, .form-table select, .form-table textarea { width: 100%; padding: 8px 10px; border: 1px solid #ddd; border-radius: 3px; font-size: 12px; }
        .form-table textarea { min-height: 80px; resize: vertical; font-family: inherit; }
        .required::after { content: ' *'; color: #f44336; }
        .detail-tabs { display: flex; gap: 2px; border-bottom: 1px solid #e0e0e0; margin-bottom: 25px; }
        .detail-tab { padding: 10px 20px; background: #f5f5f5; border: none; border-top-left-radius: 4px; border-top-right-radius: 4px; cursor: pointer; font-size: 13px; color: #666; }
        .detail-tab.active { background: white; color: #1976d2; font-weight: bold; }
        .detail-content { display: none; }
        .detail-content.active { display: block; }
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .button-group { display: flex; gap: 10px; justify-content: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e0e0e0; }
        .form-title { font-size: 16px; color: #1976d2; margin-bottom: 15px; font-weight: bold; padding-bottom: 10px; border-bottom: 2px solid #1976d2; }
        .loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .loading.active { display: flex; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #1976d2; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="loading" id="loading"><div class="spinner"></div></div>

    <div id="login-screen" class="login-screen">
        <div class="login-box">
            <div class="login-header">
                <h1>ğŸ¢ ê·¸ë£¹ ì¸ì‚¬ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <p>ê´€ë¦¬ì ë¡œê·¸ì¸</p>
                <span class="firebase-badge">ğŸ”¥ Firebase í´ë¼ìš°ë“œ ë²„ì „</span>
            </div>
            <div class="error-msg" id="login-error">ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label>ì•„ì´ë””</label>
                    <input type="text" id="login-username" required value="admin">
                </div>
                <div class="form-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="login-password" required value="admin1234">
                </div>
                <button type="submit" class="login-btn">ë¡œê·¸ì¸</button>
            </form>
        </div>
    </div>

    <div id="main-screen" class="main-screen">
        <div class="header">
            <div class="header-left"><h1>GA KOREA ì¸ì‚¬ì •ë³´ë“±ë¡ <span style="font-size: 12px; color: #ff9800;">â˜ï¸ Cloud</span></h1></div>
            <div class="header-right">
                <div class="user-info"><strong id="current-user"></strong> | <span id="current-role"></span></div>
                <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="tab-menu">
            <button class="tab-btn active" onclick="switchMainTab('employee')">ì§ì› ê´€ë¦¬</button>
        </div>

        <div id="employee-tab" class="layout">
            <div class="sidebar">
                <div class="filter-section">
                    <h3>ê²€ìƒ‰</h3>
                    <div class="filter-group">
                        <input type="text" id="search-employee" placeholder="ì´ë¦„/ì‚¬ë²ˆ..." oninput="filterEmployees()">
                    </div>
                </div>
                <div class="filter-section">
                    <div class="filter-group">
                        <label>ë²•ì¸</label>
                        <select id="filter-company" onchange="filterEmployees()">
                            <option value="">ì „ì²´</option>
                        </select>
                    </div>
                </div>
                <div class="employee-list" id="employee-list">
                    <div class="empty-state"><p>ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</p></div>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="showNewEmployeeForm()">+ ì‹ ê·œ ë“±ë¡</button>
            </div>

            <div class="main-content" id="employee-detail">
                <div class="empty-state"><h3>ì§ì›ì„ ì„ íƒí•˜ê±°ë‚˜ ì‹ ê·œ ë“±ë¡í•˜ì„¸ìš”</h3></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
    // â­ Firebase ì„¤ì • ì •ë³´ â­
    const firebaseConfig = {
        apiKey: "AIzaSyCrsPO00nsUH4iwUfHCF1aFKwcuoedqTTs",
        authDomain: "ga-korea-hr.firebaseapp.com",
        projectId: "ga-korea-hr",
        storageBucket: "ga-korea-hr.firebasestorage.app",
        messagingSenderId: "1022770625476",
        appId: "1:1022770625476:web:927f6a18be08feb5518291",
        measurementId: "G-H49VLF0C7W"
    };

    // Firebase ì´ˆê¸°í™”
    let db;
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        console.log('âœ… Firebase ì—°ê²° ì„±ê³µ');
    } catch (error) {
        console.error('âŒ Firebase ì—°ê²° ì‹¤íŒ¨:', error);
        alert('Firebase ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”. FIREBASE_GUIDE.mdë¥¼ ì°¸ê³ í•˜ì„¸ìš”.');
    }

    function showLoading() { document.getElementById('loading').classList.add('active'); }
    function hideLoading() { document.getElementById('loading').classList.remove('active'); }

    function hashPassword(password) {
        let hash = 0;
        for (let i = 0; i < password.length; i++) {
            const char = password.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        return hash.toString();
    }

    let session = null;

    async function initializeData() {
        try {
            // ê¸°ë³¸ ë²•ì¸ ë°ì´í„°
            const companiesSnapshot = await db.collection('companies').get();
            if (companiesSnapshot.empty) {
                const companies = [
                    { code: 'C001', name: 'GA KOREA', businessNumber: '123-45-67890', ceo: 'ê¹€ëŒ€í‘œ' },
                    { code: 'C002', name: 'ãˆœì§€ì—ì´í…Œí¬', businessNumber: '234-56-78901', ceo: 'ì´ì‚¬ì¥' },
                    { code: 'C003', name: 'ãˆœì§€ì—ì´ì‚°ì—…', businessNumber: '345-67-89012', ceo: 'ë°•íšŒì¥' }
                ];
                for (const company of companies) {
                    await db.collection('companies').doc(company.code).set(company);
                }
                console.log('ê¸°ë³¸ ë²•ì¸ ë°ì´í„° ìƒì„± ì™„ë£Œ');
            }

            // ê¸°ë³¸ ë¶€ì„œ ë°ì´í„°
            const deptsSnapshot = await db.collection('departments').get();
            if (deptsSnapshot.empty) {
                const departments = [
                    { code: 'D001', name: 'ê²½ì˜ì§€ì›íŒ€', companyCode: 'C001' },
                    { code: 'D002', name: 'ì¸ì‚¬íŒ€', companyCode: 'C001' },
                    { code: 'D003', name: 'ì¬ë¬´íŒ€', companyCode: 'C001' },
                    { code: 'D004', name: 'ì˜ì—…íŒ€', companyCode: 'C001' }
                ];
                for (const dept of departments) {
                    await db.collection('departments').doc(dept.code).set(dept);
                }
                console.log('ê¸°ë³¸ ë¶€ì„œ ë°ì´í„° ìƒì„± ì™„ë£Œ');
            }

            // ê¸°ë³¸ ì‚¬ìš©ì
            const usersSnapshot = await db.collection('users').get();
            if (usersSnapshot.empty) {
                await db.collection('users').doc('admin').set({
                    username: 'admin',
                    password: hashPassword('admin1234'),
                    name: 'ì‹œìŠ¤í…œê´€ë¦¬ì',
                    role: 'admin',
                    active: true
                });
                console.log('ê¸°ë³¸ ì‚¬ìš©ì ìƒì„± ì™„ë£Œ');
            }
        } catch (error) {
            console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
        }
    }

    window.addEventListener('DOMContentLoaded', async function() {
        showLoading();
        await initializeData();
        hideLoading();
        
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            showLoading();
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const hashedPassword = hashPassword(password);
            
            try {
                const userDoc = await db.collection('users').doc(username).get();
                if (userDoc.exists) {
                    const user = userDoc.data();
                    if (user.password === hashedPassword && user.active) {
                        session = user;
                        showMainScreen();
                    } else {
                        document.getElementById('login-error').style.display = 'block';
                        setTimeout(() => { document.getElementById('login-error').style.display = 'none'; }, 3000);
                    }
                } else {
                    document.getElementById('login-error').style.display = 'block';
                    setTimeout(() => { document.getElementById('login-error').style.display = 'none'; }, 3000);
                }
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
            
            hideLoading();
        });
    });

    async function showMainScreen() {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-screen').classList.add('active');
        document.getElementById('current-user').textContent = session.name;
        document.getElementById('current-role').textContent = session.role === 'admin' ? 'ì‹œìŠ¤í…œ ê´€ë¦¬ì' : 'ì¼ë°˜ ê´€ë¦¬ì';
        
        await loadCompanyFilters();
        await loadEmployees();
    }

    function logout() {
        if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            session = null;
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('main-screen').classList.remove('active');
            document.getElementById('login-form').reset();
        }
    }

    function switchMainTab(tabName) {
        // í˜„ì¬ëŠ” ì§ì› ê´€ë¦¬ë§Œ ìˆìŒ
    }

    async function loadCompanyFilters() {
        const filterSelect = document.getElementById('filter-company');
        filterSelect.innerHTML = '<option value="">ì „ì²´</option>';
        
        const snapshot = await db.collection('companies').get();
        snapshot.forEach(doc => {
            const company = doc.data();
            const option = document.createElement('option');
            option.value = company.code;
            option.textContent = company.name;
            filterSelect.appendChild(option);
        });
    }

    let allEmployees = [];

    async function loadEmployees() {
        showLoading();
        try {
            allEmployees = [];
            const snapshot = await db.collection('employees').get();
            snapshot.forEach(doc => {
                allEmployees.push({ id: doc.id, ...doc.data() });
            });
            filterEmployees();
        } catch (error) {
            console.error('ì§ì› ì¡°íšŒ ì˜¤ë¥˜:', error);
        }
        hideLoading();
    }

    function filterEmployees() {
        const searchTerm = document.getElementById('search-employee').value.toLowerCase();
        const companyFilter = document.getElementById('filter-company').value;
        
        let filtered = allEmployees;
        
        if (searchTerm) {
            filtered = filtered.filter(emp => 
                (emp.name && emp.name.toLowerCase().includes(searchTerm)) ||
                (emp.employeeId && emp.employeeId.toLowerCase().includes(searchTerm))
            );
        }
        
        if (companyFilter) {
            filtered = filtered.filter(emp => emp.companyCode === companyFilter);
        }
        
        renderEmployeeList(filtered);
    }

    async function renderEmployeeList(employees) {
        const listContainer = document.getElementById('employee-list');
        
        if (employees.length === 0) {
            listContainer.innerHTML = '<div class="empty-state"><p>ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
            return;
        }
        
        const companiesSnapshot = await db.collection('companies').get();
        const companies = {};
        companiesSnapshot.forEach(doc => {
            const c = doc.data();
            companies[c.code] = c.name;
        });
        
        listContainer.innerHTML = employees.map(emp => `
            <div class="employee-item" onclick="selectEmployee('${emp.employeeId}')">
                <div class="name">${emp.name}</div>
                <div class="info">${emp.employeeId || '-'} | ${companies[emp.companyCode] || '-'}</div>
            </div>
        `).join('');
    }

    let currentEmployeeId = null;

    function selectEmployee(employeeId) {
        currentEmployeeId = employeeId;
        const employee = allEmployees.find(emp => emp.employeeId === employeeId);
        if (!employee) return;
        
        const detailContainer = document.getElementById('employee-detail');
        detailContainer.innerHTML = `
            <h2>${employee.name} (${employee.employeeId})</h2>
            <p>ë²•ì¸: ${employee.companyCode} | ë¶€ì„œ: ${employee.departmentCode || '-'}</p>
            <p>ì§ê¸‰: ${employee.position || '-'} | ì¬ì§ìƒíƒœ: ${employee.workStatus || '-'}</p>
            <div class="button-group">
                <button class="btn btn-primary" onclick="editEmployee('${employeeId}')">ìˆ˜ì •</button>
                <button class="btn btn-secondary" onclick="deleteEmployee('${employeeId}')">ì‚­ì œ</button>
            </div>
        `;
    }

    async function deleteEmployee(employeeId) {
        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        
        showLoading();
        try {
            await db.collection('employees').doc(employeeId).delete();
            alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            await loadEmployees();
            document.getElementById('employee-detail').innerHTML = '<div class="empty-state"><h3>ì§ì›ì„ ì„ íƒí•˜ê±°ë‚˜ ì‹ ê·œ ë“±ë¡í•˜ì„¸ìš”</h3></div>';
        } catch (error) {
            console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
            alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
        hideLoading();
    }

    function editEmployee(employeeId) {
        currentEmployeeId = employeeId;
        const employee = allEmployees.find(emp => emp.employeeId === employeeId);
        if (!employee) return;
        showEmployeeForm(employee);
    }

    function showNewEmployeeForm() {
        currentEmployeeId = null;
        showEmployeeForm();
    }

    async function showEmployeeForm(employee = null) {
        const isNew = !employee;
        
        // ë²•ì¸ê³¼ ë¶€ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        const companiesSnapshot = await db.collection('companies').get();
        const departmentsSnapshot = await db.collection('departments').get();
        
        const companies = [];
        companiesSnapshot.forEach(doc => companies.push(doc.data()));
        
        const departments = [];
        departmentsSnapshot.forEach(doc => departments.push(doc.data()));
        
        // ì‚¬ë²ˆ ìë™ ìƒì„±
        function generateEmployeeId() {
            const year = new Date().getFullYear().toString().slice(2);
            const month = (new Date().getMonth() + 1).toString().padStart(2, '0');
            const random = Math.floor(Math.random() * 9000 + 1000);
            return year + month + random;
        }
        
        const detailContainer = document.getElementById('employee-detail');
        detailContainer.innerHTML = `
            <h2>${isNew ? 'ì‹ ê·œ ì§ì› ë“±ë¡' : 'ì§ì› ì •ë³´ ìˆ˜ì •'}</h2>
            
            <form id="employee-form" onsubmit="saveEmployee(event)">
                <div class="detail-tabs">
                    <button type="button" class="detail-tab active" onclick="switchFormTab(event, 'basic')">ê¸°ë³¸ì •ë³´</button>
                    <button type="button" class="detail-tab" onclick="switchFormTab(event, 'employment')">ì¬ì§ì •ë³´</button>
                </div>
                
                <div id="form-basic" class="detail-content active">
                    <div class="form-title">ê¸°ë³¸ì •ë³´</div>
                    <table class="form-table">
                        <tr>
                            <th class="required">ì‚¬ë²ˆ</th>
                            <td><input type="text" name="employeeId" value="${employee ? employee.employeeId : generateEmployeeId()}" ${!isNew ? 'readonly' : ''} required></td>
                            <th class="required">ì„±ëª…</th>
                            <td><input type="text" name="name" value="${employee?.name || ''}" required></td>
                        </tr>
                        <tr>
                            <th>ì„±ëª…(ì˜ë¬¸)</th>
                            <td><input type="text" name="nameEn" value="${employee?.nameEn || ''}"></td>
                            <th class="required">ì„±ë³„</th>
                            <td>
                                <select name="gender" required>
                                    <option value="M" ${employee?.gender === 'M' ? 'selected' : ''}>ë‚¨ì„±</option>
                                    <option value="F" ${employee?.gender === 'F' ? 'selected' : ''}>ì—¬ì„±</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th class="required">ìƒë…„ì›”ì¼</th>
                            <td><input type="date" name="birthDate" value="${employee?.birthDate || ''}" required></td>
                            <th class="required">íœ´ëŒ€ì „í™”</th>
                            <td><input type="tel" name="mobile" value="${employee?.mobile || ''}" required></td>
                        </tr>
                        <tr>
                            <th>ì£¼ì†Œ</th>
                            <td colspan="3"><input type="text" name="address" value="${employee?.address || ''}"></td>
                        </tr>
                        <tr>
                            <th>ì´ë©”ì¼</th>
                            <td><input type="email" name="companyEmail" value="${employee?.companyEmail || ''}"></td>
                            <th>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</th>
                            <td><input type="text" name="residentNumber" value="${employee?.residentNumber || ''}"></td>
                        </tr>
                    </table>
                </div>
                
                <div id="form-employment" class="detail-content">
                    <div class="form-title">ì¬ì§ì •ë³´</div>
                    <table class="form-table">
                        <tr>
                            <th class="required">ì…ì‚¬ì¼</th>
                            <td><input type="date" name="hireDate" value="${employee?.hireDate || ''}" required></td>
                            <th class="required">ì¬ì§ìƒíƒœ</th>
                            <td>
                                <select name="workStatus" required>
                                    <option value="ì¬ì§" ${!employee || employee.workStatus === 'ì¬ì§' ? 'selected' : ''}>ì¬ì§</option>
                                    <option value="íœ´ì§" ${employee?.workStatus === 'íœ´ì§' ? 'selected' : ''}>íœ´ì§</option>
                                    <option value="í‡´ì§" ${employee?.workStatus === 'í‡´ì§' ? 'selected' : ''}>í‡´ì§</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th class="required">ë²•ì¸</th>
                            <td>
                                <select name="companyCode" required>
                                    <option value="">ì„ íƒ</option>
                                    ${companies.map(c => `<option value="${c.code}" ${employee?.companyCode === c.code ? 'selected' : ''}>${c.name}</option>`).join('')}
                                </select>
                            </td>
                            <th class="required">ë¶€ì„œ</th>
                            <td>
                                <select name="departmentCode" required>
                                    <option value="">ì„ íƒ</option>
                                    ${departments.map(d => `<option value="${d.code}" ${employee?.departmentCode === d.code ? 'selected' : ''}>${d.name}</option>`).join('')}
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th class="required">ê³ ìš©í˜•íƒœ</th>
                            <td>
                                <select name="employmentType" required>
                                    <option value="">ì„ íƒ</option>
                                    <option value="ì •ê·œì§" ${employee?.employmentType === 'ì •ê·œì§' ? 'selected' : ''}>ì •ê·œì§</option>
                                    <option value="ê³„ì•½ì§" ${employee?.employmentType === 'ê³„ì•½ì§' ? 'selected' : ''}>ê³„ì•½ì§</option>
                                </select>
                            </td>
                            <th class="required">ì§ê¸‰</th>
                            <td>
                                <select name="position" required>
                                    <option value="">ì„ íƒ</option>
                                    <option value="ì‚¬ì›" ${employee?.position === 'ì‚¬ì›' ? 'selected' : ''}>ì‚¬ì›</option>
                                    <option value="ëŒ€ë¦¬" ${employee?.position === 'ëŒ€ë¦¬' ? 'selected' : ''}>ëŒ€ë¦¬</option>
                                    <option value="ê³¼ì¥" ${employee?.position === 'ê³¼ì¥' ? 'selected' : ''}>ê³¼ì¥</option>
                                    <option value="ë¶€ì¥" ${employee?.position === 'ë¶€ì¥' ? 'selected' : ''}>ë¶€ì¥</option>
                                </select>
                            </td>
                        </tr>
                    </table>
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn btn-primary">ğŸ’¾ ì €ì¥ (Firebase)</button>
                    <button type="button" class="btn btn-outline" onclick="cancelForm()">ì·¨ì†Œ</button>
                </div>
            </form>
        `;
    }

    function switchFormTab(event, tabName) {
        document.querySelectorAll('.detail-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.detail-content').forEach(content => content.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById('form-' + tabName).classList.add('active');
    }

    async function saveEmployee(event) {
        event.preventDefault();
        showLoading();
        
        try {
            const formData = new FormData(event.target);
            const employeeData = {};
            
            for (let [key, value] of formData.entries()) {
                employeeData[key] = value;
            }
            
            employeeData.updatedAt = firebase.firestore.FieldValue.serverTimestamp();
            if (!currentEmployeeId) {
                employeeData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            }
            
            // Firestoreì— ì €ì¥
            await db.collection('employees').doc(employeeData.employeeId).set(employeeData, { merge: true });
            
            alert('âœ… ' + (currentEmployeeId ? 'ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.') + ' (Firebase í´ë¼ìš°ë“œì— ì €ì¥ë¨)');
            
            await loadEmployees();
            selectEmployee(employeeData.employeeId);
            
        } catch (error) {
            console.error('ì €ì¥ ì˜¤ë¥˜:', error);
            alert('âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
        
        hideLoading();
    }

    function cancelForm() {
        if (currentEmployeeId) {
            selectEmployee(currentEmployeeId);
        } else {
            document.getElementById('employee-detail').innerHTML = '<div class="empty-state"><h3>ì§ì›ì„ ì„ íƒí•˜ê±°ë‚˜ ì‹ ê·œ ë“±ë¡í•˜ì„¸ìš”</h3></div>';
        }
    }
    </script>
</body>
</html>
