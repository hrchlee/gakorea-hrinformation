<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GA KOREA ì¸ì‚¬ì •ë³´ë“±ë¡</title>
    <script>
    // HTTPS ê°•ì œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
        location.replace('https:' + window.location.href.substring(window.location.protocol.length));
    }
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Malgun Gothic', sans-serif; background: #f5f6f8; font-size: 12px; }
        .login-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .login-box { background: white; padding: 50px; border-radius: 10px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); width: 450px; }
        .login-header { text-align: center; margin-bottom: 40px; }
        .login-header h1 { color: #333; font-size: 28px; margin-bottom: 10px; }
        .login-header p { color: #666; font-size: 14px; }
        .security-badge { background: #4caf50; color: white; padding: 4px 12px; border-radius: 12px; font-size: 11px; display: inline-block; margin-top: 10px; }
        .login-form .form-group { margin-bottom: 20px; }
        .login-form label { display: block; margin-bottom: 8px; color: #333; font-weight: bold; }
        .login-form input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        .login-btn { width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .login-btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .error-msg { background: #ffebee; color: #c62828; padding: 12px; border-radius: 4px; margin-bottom: 20px; display: none; text-align: center; font-size: 13px; }
        .info-msg { background: #e3f2fd; color: #1976d2; padding: 12px; border-radius: 4px; margin-bottom: 20px; text-align: center; font-size: 12px; }
        .main-screen { display: none; }
        .main-screen.active { display: block; }
        .header { background: white; border-bottom: 2px solid #e0e0e0; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; }
        .header-left h1 { color: #333; font-size: 18px; font-weight: bold; }
        .header-right { display: flex; gap: 15px; align-items: center; }
        .user-email { font-size: 11px; color: #666; }
        .logout-btn { padding: 8px 16px; background: white; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .tab-menu { background: white; border-bottom: 1px solid #e0e0e0; padding: 0 30px; display: flex; gap: 5px; }
        .tab-btn { padding: 12px 20px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-size: 13px; color: #666; }
        .tab-btn.active { color: #1976d2; border-bottom-color: #1976d2; font-weight: bold; }
        .layout { display: flex; height: calc(100vh - 120px); }
        .sidebar { width: 250px; background: white; border-right: 1px solid #e0e0e0; padding: 20px; overflow-y: auto; }
        .main-content { flex: 1; background: white; overflow-y: auto; padding: 25px; }
        .filter-section { margin-bottom: 20px; }
        .filter-section h3 { font-size: 13px; margin-bottom: 10px; font-weight: bold; }
        .filter-group input, .filter-group select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 3px; font-size: 12px; }
        .employee-list { border-top: 1px solid #e0e0e0; margin-top: 15px; padding-top: 15px; max-height: 400px; overflow-y: auto; }
        .employee-item { padding: 10px; border: 1px solid #e0e0e0; border-radius: 4px; margin-bottom: 8px; cursor: pointer; }
        .employee-item:hover { background: #f5f9ff; border-color: #1976d2; }
        .employee-item .name { font-weight: bold; margin-bottom: 4px; }
        .employee-item .info { font-size: 11px; color: #666; }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; font-size: 13px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: #1976d2; color: white; }
        .btn-secondary { background: #757575; color: white; }
        .btn-outline { background: white; border: 1px solid #ddd; color: #666; }
        .empty-state { text-align: center; padding: 60px 20px; color: #999; }
        .loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .loading.active { display: flex; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #1976d2; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .security-indicator { position: fixed; bottom: 20px; right: 20px; background: #4caf50; color: white; padding: 10px 15px; border-radius: 20px; font-size: 11px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <div class="loading" id="loading"><div class="spinner"></div></div>
    <div class="security-indicator">ğŸ”’ HTTPS + Firebase Auth</div>

    <div id="login-screen" class="login-screen">
        <div class="login-box">
            <div class="login-header">
                <h1>ğŸ¢ ê·¸ë£¹ ì¸ì‚¬ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <p>ë³´ì•ˆ ë¡œê·¸ì¸</p>
                <span class="security-badge">ğŸ” Firebase Authentication</span>
            </div>
            <div class="info-msg">Firebase Authenticationìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤</div>
            <div class="error-msg" id="login-error">ë¡œê·¸ì¸ ì‹¤íŒ¨</div>
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label>ì´ë©”ì¼</label>
                    <input type="email" id="login-email" placeholder="example@company.com" required>
                </div>
                <div class="form-group">
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="login-btn" id="login-btn">ë¡œê·¸ì¸</button>
            </form>
            <p style="text-align: center; margin-top: 20px; font-size: 11px; color: #999;">
                ê´€ë¦¬ì ê³„ì •ì´ í•„ìš”í•©ë‹ˆë‹¤
            </p>
        </div>
    </div>

    <div id="main-screen" class="main-screen">
        <div class="header">
            <div class="header-left"><h1>GA KOREA ì¸ì‚¬ì •ë³´ë“±ë¡ <span style="font-size: 11px; color: #4caf50;">ğŸ”’ ë³´ì•ˆ ì—°ê²°</span></h1></div>
            <div class="header-right">
                <div>
                    <strong id="current-user"></strong>
                    <div class="user-email" id="current-email"></div>
                </div>
                <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <div class="tab-menu">
            <button class="tab-btn active" onclick="switchMainTab('employee')">ì§ì› ê´€ë¦¬</button>
            <button class="tab-btn" onclick="switchMainTab('roster')">ì„ì§ì› ëª…ë¶€</button>
            <button class="tab-btn" onclick="switchMainTab('company')">ë²•ì¸ ê´€ë¦¬</button>
            <button class="tab-btn" onclick="switchMainTab('admin')">ì‹œìŠ¤í…œ ê´€ë¦¬ì</button>
        </div>

        <div id="employee-tab" class="layout">
            <div class="sidebar">
                <div class="filter-section">
                    <h3>ê²€ìƒ‰</h3>
                    <input type="text" id="search-employee" placeholder="ì´ë¦„/ì‚¬ë²ˆ..." oninput="filterEmployees()">
                </div>
                <div class="filter-section">
                    <h3>ë²•ì¸</h3>
                    <select id="filter-company" onchange="filterEmployees()"></select>
                </div>
                <div class="employee-list" id="employee-list">
                    <div class="empty-state"><p>ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</p></div>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="alert('ì§ì› ë“±ë¡ ê¸°ëŠ¥ ì¤€ë¹„ì¤‘')">+ ì‹ ê·œ ë“±ë¡</button>
            </div>

            <div class="main-content" id="employee-detail">
                <div class="empty-state"><h3>Firebase Authenticationìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤</h3><p style="margin-top: 10px;">ì´ì œ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p></div>
            </div>
        </div>

        <div id="roster-tab" class="layout" style="display: none;">
            <div class="main-content"><div class="empty-state"><h3>ì„ì§ì› ëª…ë¶€</h3></div></div>
        </div>

        <div id="company-tab" class="layout" style="display: none;">
            <div class="main-content"><div class="empty-state"><h3>ë²•ì¸ ê´€ë¦¬</h3></div></div>
        </div>

        <div id="admin-tab" class="layout" style="display: none;">
            <div class="main-content"><div class="empty-state"><h3>ì‹œìŠ¤í…œ ê´€ë¦¬ì</h3></div></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, getDocs, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCrsPO00nsUH4iwUfHCF1aFKwcuoedqTTs",
            authDomain: "ga-korea-hr.firebaseapp.com",
            projectId: "ga-korea-hr",
            storageBucket: "ga-korea-hr.firebasestorage.app",
            messagingSenderId: "1022770625476",
            appId: "1:1022770625476:web:927f6a18be08feb5518291"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        window.db = db;
        window.auth = auth;
        window.collection = collection;
        window.getDocs = getDocs;
        window.doc = doc;
        window.setDoc = setDoc;
        window.getDoc = getDoc;
        
        console.log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ');
        console.log('ğŸ”’ Firebase Authentication í™œì„±í™”');

        let currentUser = null;

        // ì¸ì¦ ìƒíƒœ ê°ì§€
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log('âœ… ë¡œê·¸ì¸ë¨:', user.email);
                currentUser = user;
                await showMainScreen(user);
            } else {
                console.log('âŒ ë¡œê·¸ì•„ì›ƒ ìƒíƒœ');
                showLoginScreen();
            }
        });

        // ë¡œê·¸ì¸ í¼ ì²˜ë¦¬
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const loginBtn = document.getElementById('login-btn');
            const errorMsg = document.getElementById('login-error');
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
            errorMsg.style.display = 'none';
            
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log('âœ… ë¡œê·¸ì¸ ì„±ê³µ:', userCredential.user.email);
                // onAuthStateChangedê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬
            } catch (error) {
                console.error('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:', error.code, error.message);
                
                let errorText = 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                if (error.code === 'auth/user-not-found') {
                    errorText = 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                } else if (error.code === 'auth/wrong-password') {
                    errorText = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                } else if (error.code === 'auth/invalid-email') {
                    errorText = 'ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorText = 'ë„ˆë¬´ ë§ì€ ì‹œë„ë¥¼ í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.';
                } else if (error.code === 'auth/invalid-credential') {
                    errorText = 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                }
                
                errorMsg.textContent = errorText;
                errorMsg.style.display = 'block';
                
                loginBtn.disabled = false;
                loginBtn.textContent = 'ë¡œê·¸ì¸';
            }
        });

        function showLoginScreen() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('main-screen').classList.remove('active');
        }

        async function showMainScreen(user) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-screen').classList.add('active');
            
            // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
            const userName = user.email.split('@')[0];
            document.getElementById('current-user').textContent = userName;
            document.getElementById('current-email').textContent = user.email;
            
            await loadCompanyFilters();
            await loadEmployees();
        }

        window.logout = async function() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    await signOut(auth);
                    console.log('âœ… ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
                } catch (error) {
                    console.error('âŒ ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                    alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        window.switchMainTab = function(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('employee-tab').style.display = 'none';
            document.getElementById('roster-tab').style.display = 'none';
            document.getElementById('company-tab').style.display = 'none';
            document.getElementById('admin-tab').style.display = 'none';
            
            document.getElementById(tabName + '-tab').style.display = 'flex';
        }

        async function loadCompanyFilters() {
            const select = document.getElementById('filter-company');
            select.innerHTML = '<option value="">ì „ì²´</option>';
            
            const snapshot = await getDocs(collection(db, 'companies'));
            snapshot.forEach(doc => {
                const c = doc.data();
                select.innerHTML += `<option value="${c.code}">${c.name}</option>`;
            });
        }

        let allEmployees = [];

        async function loadEmployees() {
            allEmployees = [];
            const snapshot = await getDocs(collection(db, 'employees'));
            snapshot.forEach(doc => {
                allEmployees.push({ id: doc.id, ...doc.data() });
            });
            filterEmployees();
        }

        function filterEmployees() {
            const search = document.getElementById('search-employee').value.toLowerCase();
            const company = document.getElementById('filter-company').value;
            
            let filtered = allEmployees.filter(emp => {
                const matchSearch = !search || (emp.name && emp.name.toLowerCase().includes(search)) || (emp.employeeId && emp.employeeId.includes(search));
                const matchCompany = !company || company === 'C001' || emp.companyCode === company;
                return matchSearch && matchCompany;
            });
            
            renderEmployeeList(filtered);
        }

        function renderEmployeeList(employees) {
            const list = document.getElementById('employee-list');
            if (employees.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</p></div>';
                return;
            }
            
            list.innerHTML = employees.map(emp => `
                <div class="employee-item">
                    <div class="name">${emp.name}</div>
                    <div class="info">${emp.employeeId}</div>
                </div>
            `).join('');
        }

        // ì´ˆê¸° ë°ì´í„° ìƒì„±
        async function initializeData() {
            const companiesRef = collection(db, 'companies');
            const snap = await getDocs(companiesRef);
            
            if (snap.empty) {
                await setDoc(doc(db, 'companies', 'C001'), { code: 'C001', name: 'GA KOREA' });
                await setDoc(doc(db, 'companies', 'C002'), { code: 'C002', name: 'ãˆœì§€ì—ì´í…Œí¬' });
                await setDoc(doc(db, 'companies', 'C003'), { code: 'C003', name: 'ãˆœì§€ì—ì´ì‚°ì—…' });
                console.log('âœ… ê¸°ë³¸ ë°ì´í„° ìƒì„±');
            }
        }

        initializeData();
    </script>
</body>
</html>
